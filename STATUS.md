# ğŸš€ FashionXG æœ¬åœ°å¤„ç†ç«¯ - å½“å‰çŠ¶æ€

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒè„šæœ¬å·²åˆ›å»º
- âœ… `comfy_bridge.py` - ä¸»æ¡¥æ¥è„šæœ¬ï¼ˆ17KBï¼‰
- âœ… `update_preference_lib.py` - åå¥½é…ç½®æ›´æ–°å™¨ï¼ˆ7.5KBï¼‰
- âœ… `start_bridge.sh` - è‡ªåŠ¨å¯åŠ¨è„šæœ¬
- âœ… `check_setup.py` - ç¯å¢ƒæ£€æŸ¥å·¥å…·
- âœ… `explore_server.py` - æœåŠ¡å™¨APIæ¢æµ‹å·¥å…·

### 2. ç¯å¢ƒé…ç½®
- âœ… Pythonè™šæ‹Ÿç¯å¢ƒå·²åˆ›å»ºï¼ˆ`venv/`ï¼‰
- âœ… ä¾èµ–åŒ…å·²å®‰è£…ï¼ˆrequests, websocket-client, beautifulsoup4ï¼‰
- âœ… æœåŠ¡å™¨URLå·²é…ç½®ï¼ˆ`.env`æ–‡ä»¶ï¼‰
- âœ… ç¤ºä¾‹åå¥½é…ç½®å·²åˆ›å»ºï¼ˆ`preference_profile.json`ï¼‰

### 3. æ–‡æ¡£
- âœ… `README_BRIDGE.md` - å®Œæ•´ä½¿ç”¨æŒ‡å—
- âœ… `IMPLEMENTATION_SUMMARY.md` - å®ç°æ€»ç»“
- âœ… `fashion_tagger_api.json.template` - å·¥ä½œæµæ¨¡æ¿

## ğŸ“‹ ä¸‹ä¸€æ­¥éœ€è¦åšçš„äº‹æƒ…

### é˜¶æ®µ1: æœåŠ¡å™¨ç«¯APIå®ç°ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

**é—®é¢˜**: å½“å‰æœåŠ¡å™¨ï¼ˆhttp://45.249.246.186:5000ï¼‰åªæœ‰Flaskå‰ç«¯ï¼Œç¼ºå°‘APIç«¯ç‚¹ã€‚

**éœ€è¦å®ç°çš„APIç«¯ç‚¹**:

1. **GET /api/images/pending** - è·å–å¾…å¤„ç†å›¾ç‰‡
   ```json
   [
     {
       "pin_id": "123456789",
       "image_url": "https://...",
       "source_keyword": "minimalist dress",
       "process_status": 0
     }
   ]
   ```

2. **POST /api/tags/update** - æ›´æ–°å›¾ç‰‡æ ‡ç­¾
   ```json
   {
     "pin_id": "123456789",
     "aesthetic_score": 8.5,
     "fashion_tags": {...},
     "description": "...",
     "tags_list": [...],
     "process_status": 1
   }
   ```

3. **GET /api/images/processed** - è·å–å·²å¤„ç†å›¾ç‰‡ï¼ˆç”¨äºæ„å»ºåå¥½é…ç½®ï¼‰
   ```json
   [
     {
       "pin_id": "123456789",
       "designer_rating": 1,  // -1, 0, 1
       "tags_list": [...],
       "fashion_tags": {...}
     }
   ]
   ```

**å®ç°æ–¹å¼**:
- é€‰é¡¹A: åœ¨ç°æœ‰Flaskåº”ç”¨ä¸­æ·»åŠ APIè·¯ç”±
- é€‰é¡¹B: å¯åŠ¨FastAPIåº”ç”¨ï¼ˆæ ¹æ®readme-web.mdï¼Œä»£ç åº”è¯¥å·²ç»å­˜åœ¨ï¼‰
- é€‰é¡¹C: åˆ›å»ºç®€å•çš„APIåŒ…è£…å™¨

### é˜¶æ®µ2: ComfyUIå®‰è£…ä¸é…ç½®ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

**éœ€è¦åšçš„**:

1. **å®‰è£…ComfyUI**
   ```bash
   cd ~ && git clone https://github.com/comfyanonymous/ComfyUI.git
   cd ~/ComfyUI && pip install -r requirements.txt
   ```

2. **å®‰è£…è‡ªå®šä¹‰èŠ‚ç‚¹**
   ```bash
   cd ~/ComfyUI/custom_nodes

   # WD14 Tagger - å·¥ä¸šçº§æ ‡ç­¾æå–
   git clone https://github.com/pythongosssss/ComfyUI-WD14-Tagger.git

   # Florence-2 - é«˜è´¨é‡æè¿°ç”Ÿæˆ
   git clone https://github.com/kijai/ComfyUI-Florence2.git

   # Aesthetic Scoreï¼ˆå¯é€‰ä½†æ¨èï¼‰
   # éœ€è¦ä¸‹è½½æ¨¡å‹æƒé‡: sac+logos+ava1-l14-linear.pth
   ```

3. **å¯åŠ¨ComfyUI**
   ```bash
   cd ~/ComfyUI
   python main.py --listen 127.0.0.1 --port 8188
   ```

4. **åˆ›å»ºå·¥ä½œæµ**
   - æ‰“å¼€ http://127.0.0.1:8188
   - æ­å»ºæµç¨‹: LoadImage â†’ WD14Tagger â†’ Florence2 â†’ AestheticScore
   - å¯ç”¨å¼€å‘è€…æ¨¡å¼ï¼ˆSettings â†’ Enable Dev modeï¼‰
   - å¯¼å‡ºä¸ºAPIæ ¼å¼: Save (API Format)
   - ä¿å­˜ä¸º `fashion_tagger_api.json`

### é˜¶æ®µ3: æµ‹è¯•ä¸è°ƒè¯•ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰

**æµ‹è¯•æ­¥éª¤**:

1. **æµ‹è¯•ComfyUIè¿æ¥**
   ```bash
   curl http://127.0.0.1:8188
   ```

2. **æµ‹è¯•æœåŠ¡å™¨API**
   ```bash
   curl http://45.249.246.186:5000/api/images/pending
   ```

3. **è¿è¡Œç¯å¢ƒæ£€æŸ¥**
   ```bash
   source venv/bin/activate
   python check_setup.py
   ```

4. **å•æ¬¡å¤„ç†æµ‹è¯•**
   ```bash
   ./start_bridge.sh --once
   ```

5. **æŒç»­è¿è¡Œ**
   ```bash
   ./start_bridge.sh --batch-size 5 --sleep 3
   ```

## ğŸ”§ ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆA: æœ¬åœ°æµ‹è¯•æ¨¡å¼

å¦‚æœæœåŠ¡å™¨APIæš‚æ—¶æ— æ³•å®ç°ï¼Œå¯ä»¥åˆ›å»ºæœ¬åœ°æµ‹è¯•æ¨¡å¼:

1. **åˆ›å»ºæ¨¡æ‹Ÿæ•°æ®**
   ```bash
   mkdir -p test_data/images
   # æ”¾å…¥ä¸€äº›æµ‹è¯•å›¾ç‰‡
   ```

2. **ä¿®æ”¹bridgeè„šæœ¬ä½¿ç”¨æœ¬åœ°æ•°æ®**
   - è·³è¿‡æœåŠ¡å™¨APIè°ƒç”¨
   - ç›´æ¥è¯»å–æœ¬åœ°å›¾ç‰‡
   - è¾“å‡ºç»“æœåˆ°JSONæ–‡ä»¶

### æ–¹æ¡ˆB: ç›´æ¥æ•°æ®åº“è®¿é—®

å¦‚æœå¯ä»¥è®¿é—®æœåŠ¡å™¨çš„SQLiteæ•°æ®åº“:

1. **ä¸‹è½½æ•°æ®åº“æ–‡ä»¶**
   ```bash
   scp user@45.249.246.186:/path/to/fashion.db ./
   ```

2. **ä¿®æ”¹è„šæœ¬ç›´æ¥æŸ¥è¯¢æ•°æ®åº“**
   - ä½¿ç”¨sqlite3è¯»å–pending images
   - ç›´æ¥æ›´æ–°æ•°æ®åº“è®°å½•

## ğŸ“Š å½“å‰ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    äº‘ç«¯æœåŠ¡å™¨                              â”‚
â”‚              http://45.249.246.186:5000                 â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Flask Web   â”‚         â”‚  APIç«¯ç‚¹     â”‚             â”‚
â”‚  â”‚  (å·²è¿è¡Œ)     â”‚         â”‚  (éœ€è¦å®ç°)   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚        SQLite Database                â”‚              â”‚
â”‚  â”‚  - imagesè¡¨ (1479æ¡è®°å½•)              â”‚              â”‚
â”‚  â”‚  - interactionsè¡¨                     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†• (APIè°ƒç”¨ - å¾…å®ç°)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Macæœ¬åœ°å¤„ç†ç«¯                          â”‚
â”‚              /Users/sunzemuzi/Downloads/                â”‚
â”‚                  fashionxg-local/                       â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚     comfy_bridge.py (å·²å®Œæˆ)          â”‚              â”‚
â”‚  â”‚  - æ‹‰å–å¾…å¤„ç†å›¾ç‰‡                      â”‚              â”‚
â”‚  â”‚  - å‘é€åˆ°ComfyUIå¤„ç†                  â”‚              â”‚
â”‚  â”‚  - åº”ç”¨é€»è¾‘è¿‡æ»¤                        â”‚              â”‚
â”‚  â”‚  - å›ä¼ ç»“æœåˆ°æœåŠ¡å™¨                    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                         â†•                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚      ComfyUI (éœ€è¦å®‰è£…)                â”‚              â”‚
â”‚  â”‚  - WD14 Tagger                        â”‚              â”‚
â”‚  â”‚  - Florence-2                         â”‚              â”‚
â”‚  â”‚  - Aesthetic Score                    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æ¨èæ‰§è¡Œé¡ºåº

### ç«‹å³å¯åšï¼ˆä¸ä¾èµ–å…¶ä»–ç»„ä»¶ï¼‰:

1. âœ… **å®‰è£…ComfyUI** - ç‹¬ç«‹ä»»åŠ¡ï¼Œå¯ä»¥å…ˆåš
   ```bash
   cd ~ && git clone https://github.com/comfyanonymous/ComfyUI.git
   cd ~/ComfyUI && pip install -r requirements.txt
   ```

2. âœ… **å®‰è£…ComfyUIè‡ªå®šä¹‰èŠ‚ç‚¹**
   ```bash
   cd ~/ComfyUI/custom_nodes
   git clone https://github.com/pythongosssss/ComfyUI-WD14-Tagger.git
   git clone https://github.com/kijai/ComfyUI-Florence2.git
   ```

3. âœ… **åˆ›å»ºComfyUIå·¥ä½œæµ**
   - å¯åŠ¨ComfyUIå¹¶åˆ›å»ºå·¥ä½œæµ
   - å¯¼å‡ºAPIæ ¼å¼JSON

### éœ€è¦åè°ƒï¼ˆä¾èµ–æœåŠ¡å™¨ï¼‰:

4. â³ **å®ç°æœåŠ¡å™¨APIç«¯ç‚¹** - éœ€è¦è®¿é—®æœåŠ¡å™¨ä»£ç 
   - å¯èƒ½éœ€è¦SSHåˆ°æœåŠ¡å™¨
   - æˆ–è€…æä¾›APIå®ç°ä»£ç è®©æœåŠ¡å™¨ç®¡ç†å‘˜éƒ¨ç½²

5. â³ **ç«¯åˆ°ç«¯æµ‹è¯•** - éœ€è¦APIå’ŒComfyUIéƒ½å°±ç»ª

## ğŸ’¡ å»ºè®®

### å¦‚æœä½ æœ‰æœåŠ¡å™¨è®¿é—®æƒé™:

1. SSHåˆ°æœåŠ¡å™¨
2. æ‰¾åˆ°FashionXGé¡¹ç›®ç›®å½•
3. æ ¹æ®readme-web.mdå¯åŠ¨FastAPIåº”ç”¨:
   ```bash
   python -m uvicorn backend.api.fastapi_app:app --port 8000
   ```
4. æˆ–è€…åœ¨Flaskåº”ç”¨ä¸­æ·»åŠ APIè·¯ç”±

### å¦‚æœæ²¡æœ‰æœåŠ¡å™¨è®¿é—®æƒé™:

1. å…ˆå®ŒæˆComfyUIçš„å®‰è£…å’Œé…ç½®
2. åˆ›å»ºæœ¬åœ°æµ‹è¯•æ¨¡å¼
3. ç­‰å¾…æœåŠ¡å™¨APIå®ç°åå†è¿æ¥

## ğŸ“ éœ€è¦çš„ä¿¡æ¯

1. **æœåŠ¡å™¨è®¿é—®æƒé™**: æ˜¯å¦å¯ä»¥SSHåˆ°æœåŠ¡å™¨ï¼Ÿ
2. **APIå®ç°**: æœåŠ¡å™¨ç«¯æ˜¯å¦å·²æœ‰FastAPIä»£ç ï¼Ÿåœ¨å“ªä¸ªç«¯å£è¿è¡Œï¼Ÿ
3. **æ•°æ®åº“è®¿é—®**: æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®SQLiteæ•°æ®åº“æ–‡ä»¶ï¼Ÿ

---

**å½“å‰çŠ¶æ€**: ğŸŸ¡ æœ¬åœ°ç«¯å·²å°±ç»ªï¼Œç­‰å¾…æœåŠ¡å™¨APIå®ç°æˆ–ComfyUIå®‰è£…
**æ›´æ–°æ—¶é—´**: 2026-02-08 02:15
